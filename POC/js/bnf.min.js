!function(r){function t(r){this.string=r,this.clearString=r,this.varHash={}}t.prototype={init:function(r){if("string"!=typeof r)throw new Error("参数错误：init()的参数必须为string类型");var r=UT.trim(r);return r?(r=this.preProcess(r),this.command(r)):""},preProcess:function(r){var t="";return r.replace(/\'[^']*\'|\"[^"]*\"/g,function(r){do{t=UT.getRandString()}while(t in this.varHash);return this.varHash[t]=r,t}.bind(this))},command:function(r){var r=UT.trim(r),t=r.length;return";"==r[t-1]?(this.sentence(r.substring(0,t-1)),null):this.sentence(r)},sentence:function(r){var r=UT.trim(r),t=[];if(t=r.match(/^if\s*\((.*)\)\s*(.*)else\s*(.*)\s*end\s*/)){var i=t[1],n=t[2],e=t[3];return this.boolExpr(i)?this.sentence(n):this.sentence(e)}for(var s=/([^\w]*)(sin|cos|max|min)*\s*\(([^()]*)\)/;s.test(r);)r=r.replace(s,function(r,t,i,n){if("sin"==i)return t+Math.sin(this.arithExpr(n));if("cos"==i)return t+Math.cos(this.arithExpr(n));var e=n.split(",").map(function(r){return this.arithExpr(r)}.bind(this));switch(i){case"max":return t+UT.max(e);case"min":return t+UT.min(e);default:return t+this.arithExpr(n)}}.bind(this)),console.log(r);for(var a=/([^\?\:]*)\?([^\?\:]*)\:(.*)/;a.test(r);)r=r.replace(a,function(r,t,i,n){return this.boolExpr(t)?this.sentence(i):this.sentence(n)}.bind(this)),console.log(r);var h=r.indexOf("=");if(h>0){var o=UT.trim(r.substring(0,h)),u=UT.trim(r.substring(h+1));if(!UT.isVariable(o))throw new Error("Uncaught SyntaxError: Invalid or unexpected token");if(UT.isDel(u))return this.varHash[o]=null,"Prompt: variable '"+o+"' is deleted";var c=this.expr(u);return this.varHash[o]=c,o+" = "+c}return"ans = "+this.expr(r)},expr:function(r){return this.arithExpr(r)},arithExpr:function(r){if(r=UT.trim(r),UT.isNumber(r))return parseFloat(r);if(UT.isBool(r))return"true"==r;if(UT.isVariable(r)){if(this.varHash.hasOwnProperty(r)&&null!=this.varHash[r])return this.varHash[r];throw new Error("Uncaught ReferenceError: "+r+" is not defined")}var t="",i="",n="",e="";if(e=r.match(/(.*\w+)\s*([\+\-])(.+)/))return t=e[1],i=e[2],n=e[3],UT.calculate(this.arithExpr(t),this.arithExpr(n),i);if(e=r.match(/(.*\w+)\s*([\*\/\%])(.+)/))return t=e[1],i=e[2],n=e[3],UT.calculate(this.arithExpr(t),this.arithExpr(n),i);if(e=r.match(/([^\/^]*\w+)\s*([\^])(.+)/))return t=e[1],n=e[3],Math.pow(this.arithExpr(t),this.arithExpr(n));throw new Error("Uncaught SyntaxError: Invalid or unexpected token")},boolExpr:function(r){r=UT.trim(r);if(UT.isBool(r))return"true"==r;var t=r.match(/(.*)(==|!=|<=|>=|>|<|&&|\|\||!)(.+)/);if(!t)throw new Error("Uncaught SyntaxError: Invalid or unexpected token");var i=t[1],n=t[2],e=t[3];switch(n){case"==":return this.arithExpr(i)==this.arithExpr(e);case"!=":return this.arithExpr(i)!=this.arithExpr(e);case"<=":return this.arithExpr(i)<=this.arithExpr(e);case">=":return this.arithExpr(i)>=this.arithExpr(e);case"<":return this.arithExpr(i)<this.arithExpr(e);case">":return this.arithExpr(i)>this.arithExpr(e);case"&&":return this.arithExpr(i)&&this.arithExpr(e);case"||":return this.arithExpr(i)||this.arithExpr(e);case"!":return!this.arithExpr(e);default:throw new Error("Uncaught SyntaxError: Invalid or unexpected token")}}},r.BNF=t}(window);